<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra – Herbal AI Hub</title>
  <style>
    /* ===== RESET & BASE ===== */
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif;}
    body{display:flex;height:100vh;overflow:hidden;background:#0D1117;color:#E0E0E0;transition:background .3s;}
    a{color:inherit;text-decoration:none;}button,input,select,textarea{font-family:inherit;}
    button{cursor:pointer;border:none;background:none;color:inherit;}
    .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

    /* ===== VARIABLES ===== */
    :root{
      --accent:#8ECDF1;
      --bg1:#161B22;
      --bg2:#1E2126;
      --muted:rgba(224,224,224,0.6);
      --radius:8px;
      --transition:.25s ease;
    }

    /* ===== SIDEBAR ===== */
    #sidebar{width:240px;background:var(--bg1);flex-shrink:0;display:flex;flex-direction:column;transition:width .3s;}
    .brand{padding:1.5rem;font-size:1.3rem;font-weight:700;color:var(--accent);}
    .brand i{margin-right:.5rem;}
    .nav-links{flex:1;}
    .nav-links a{display:flex;align-items:center;gap:1rem;padding:.9rem 1.2rem;transition:background var(--transition);}
    .nav-links a:hover,.nav-links a.active{background:var(--accent)20;}
    .nav-links i{width:24px;text-align:center;color:var(--accent);}
    .toggle-sidebar{padding:1rem;text-align:center;border-top:1px solid #29303A;cursor:pointer;}
    .toggle-sidebar i{font-size:1.2rem;color:var(--accent);}

    /* ===== MAIN ===== */
    #main{flex:1;display:flex;flex-direction:column;}
    header{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;
      background:var(--bg1)CC;backdrop-filter:blur(6px);position:sticky;top:0;z-index:10;}
    .header-left{display:flex;align-items:center;gap:1rem;}
    #toggleSidebarBtn{font-size:1.4rem;cursor:pointer;}
    .greeting h1{font-size:1.9rem;display:flex;align-items:center;gap:.5rem;}
    .greeting p{opacity:.75;}
    .header-right i{margin-left:1rem;font-size:1.4rem;cursor:pointer;transition:transform .2s;}
    .header-right i:hover{transform:scale(1.2);}
    .content{padding:1rem 2rem;overflow-y:auto;flex:1;}

    /* ===== STAT CARDS ===== */
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1.5rem;margin-bottom:1.5rem;}
    .stat-card{background:var(--bg2);border-radius:var(--radius);padding:1rem;display:flex;align-items:center;gap:1rem;
      transition:transform var(--transition),box-shadow var(--transition);}
    .stat-card:hover{transform:translateY(-4px);box-shadow:0 4px 12px rgba(0,0,0,0.5);}
    .stat-card i{font-size:1.8rem;color:var(--accent);}
    .stat-card .details h3{font-size:1.1rem;margin-bottom:.3rem;}
    .stat-card .details p{opacity:.8;color:var(--accent);}

    /* ===== MODULES ===== */
    section{background:var(--bg2);border-radius:var(--radius);padding:1rem;margin-bottom:1.5rem;transition:box-shadow var(--transition);}
    section:hover{box-shadow:0 4px 12px rgba(0,0,0,0.5);}
    section h3{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;font-size:1rem;}
    section h3 i{color:var(--accent);}
    section label{display:block;margin-bottom:.25rem;}
    section input,section select,section textarea,section button{
      width:100%;background:var(--bg1);border:1px solid #29303A;padding:.5rem;border-radius:var(--radius);
      color:inherit;transition:border-color var(--transition);margin-bottom:.5rem;
    }
    section input:focus,section select:focus,section textarea:focus{border-color:var(--accent);outline:none;}
    section button{background:var(--accent);color:#0D1117;padding:.5rem 1rem;width:auto;}
    section button:hover{background:var(--accent)CC;}
    .small{font-size:.9rem;color:var(--muted);margin-top:.5rem;}

    /* ===== CHATBOX ===== */
    #chatBox{height:120px;overflow-y:auto;background:var(--bg1);border:1px solid #29303A;border-radius:var(--radius);padding:.5rem;}
    .chat-area{display:flex;gap:.5rem;}

    /* ===== CHART ===== */
    .chart-box{background:var(--bg2);border-radius:var(--radius);padding:1rem;margin-bottom:1.5rem;}
    .chart-box canvas{width:100%!important;height:180px!important;}

    /* ===== RESPONSIVE ===== */
    @media(max-width:768px){
      #sidebar{position:fixed;left:-240px;transition:left .3s;}
      #sidebar.show{left:0;}
      #toggleSidebarBtn{display:block;}
      .stats{grid-template-columns:1fr;}
    }
  </style>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-medkit"></i> Vitra</div>
    <nav aria-label="Main navigation" class="nav-links">
      <a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="#" class="active"><i class="fas fa-seedling"></i> Herbal AI</a>
      <a href="#"><i class="fas fa-brain"></i> Mental Health</a>
      <a href="#"><i class="fas fa-utensils"></i> Diet</a>
      <a href="#"><i class="fas fa-pills"></i> E-Pharmacy</a>
      <a href="#"><i class="fas fa-calendar-check"></i> Booking</a>
      <a href="#"><i class="fas fa-cog"></i> Settings</a>
    </nav>
    <button class="toggle-sidebar" aria-label="Collapse sidebar"><i class="fas fa-arrow-circle-left"></i></button>
  </aside>

  <!-- MAIN -->
  <div id="main">
    <header>
      <div class="header-left">
        <i id="toggleSidebarBtn" class="fas fa-bars" aria-label="Open sidebar"></i>
        <div class="greeting">
          <h1><i class="fas fa-seedling"></i> Herbal AI Hub</h1>
          <p>All your AI-powered herb tools</p>
        </div>
      </div>
      <div class="header-right">
        <i id="themeToggle" class="fas fa-moon" aria-label="Toggle theme"></i>
      </div>
    </header>

    <main class="content">
      <!-- Stats -->
      <section aria-labelledby="stats-title" class="stats">
        <h2 id="stats-title" class="visually-hidden">Usage Statistics</h2>
        <div class="stat-card"><i class="fas fa-stethoscope"></i>
          <div class="details"><h3>Diagnostics</h3><p id="stat-dx">0</p></div>
        </div>
        <div class="stat-card"><i class="fas fa-user-shield"></i>
          <div class="details"><h3>Formulations</h3><p id="stat-form">0</p></div>
        </div>
        <div class="stat-card"><i class="fas fa-search"></i>
          <div class="details"><h3>ID Requests</h3><p id="stat-id">0</p></div>
        </div>
        <div class="stat-card"><i class="fas fa-chart-pie"></i>
          <div class="details"><h3>Efficacy</h3><p id="stat-pred">0</p></div>
        </div>
      </section>

      <!-- 1. AI Diagnostic Tool -->
      <section id="diagnostics" aria-labelledby="diagnostics-title">
        <h3 id="diagnostics-title"><i class="fas fa-stethoscope"></i> AI Diagnostic Tool</h3>
        <form id="diagnosticsForm">
          <label for="dxInput">Symptoms, history, labs:</label>
          <textarea id="dxInput" required></textarea>
          <button type="submit"><i class="fas fa-notes-medical"></i> Analyze</button>
        </form>
        <div role="alert" id="dxResult" class="small"></div>
      </section>

      <!-- 2. Personalized Formulation -->
      <section id="formulations" aria-labelledby="formulations-title">
        <h3 id="formulations-title"><i class="fas fa-user-shield"></i> Personalized Formulation</h3>
        <form id="formulationForm">
          <label for="pfHerbs">Select herbs:</label>
          <select id="pfHerbs" multiple required>
            <option>Ginkgo Biloba</option>
            <option>Turmeric</option>
            <option>Valerian</option>
            <option>Ashwagandha</option>
            <option>Echinacea</option>
          </select>
          <label for="pfAge">Age:</label>
          <input type="number" id="pfAge" min="1" required>
          <label for="pfWeight">Weight (kg):</label>
          <input type="number" id="pfWeight" min="1" required>
          <button type="submit"><i class="fas fa-cog"></i> Generate</button>
        </form>
        <div role="alert" id="pfResult" class="small"></div>
      </section>

      <!-- 3. Ingredient Identification -->
      <section id="identification" aria-labelledby="identification-title">
        <h3 id="identification-title"><i class="fas fa-leaf"></i> Ingredient Identification</h3>
        <form id="identificationForm">
          <label for="ingUpload" class="visually-hidden">Upload plant image</label>
          <input type="file" id="ingUpload" accept="image/*" required>
          <button type="submit"><i class="fas fa-microscope"></i> Identify</button>
        </form>
        <div role="alert" id="ingResult" class="small"></div>
      </section>

      <!-- 4. Predictive Efficacy -->
      <section id="efficacy" aria-labelledby="efficacy-title">
        <h3 id="efficacy-title"><i class="fas fa-chart-pie"></i> Predictive Efficacy</h3>
        <form id="efficacyForm">
          <label for="predInput">Herb & condition:</label>
          <input id="predInput" required>
          <button type="submit"><i class="fas fa-brain"></i> Predict</button>
        </form>
        <div role="alert" id="predResult" class="small"></div>
      </section>

      <!-- 5. Education Chatbot -->
      <section id="education" aria-labelledby="education-title">
        <h3 id="education-title"><i class="fas fa-graduation-cap"></i> Education Chatbot</h3>
        <div id="chatBox" aria-live="polite" class="small"></div>
        <form id="chatForm" class="chat-area">
          <label for="chatInput" class="visually-hidden">Your question</label>
          <input id="chatInput" placeholder="Ask about herbal medicine…" required>
          <button type="submit"><i class="fas fa-paper-plane"></i></button>
        </form>
      </section>

      <!-- Encyclopedia Search -->
      <section id="encyclopedia" aria-labelledby="encyclopedia-title">
        <h3 id="encyclopedia-title"><i class="fas fa-book"></i> Herb Encyclopedia</h3>
        <label for="searchHerb" class="visually-hidden">Search herbs</label>
        <input id="searchHerb" placeholder="Search herbs…">
        <table>
          <thead><tr><th>Name</th><th>Use</th><th>Category</th></tr></thead>
          <tbody id="herbTable">
            <tr><td>Ginkgo Biloba</td><td>Memory</td><td>Leaf</td></tr>
            <tr><td>Turmeric</td><td>Inflammation</td><td>Root</td></tr>
            <tr><td>St. John’s Wort</td><td>Mood</td><td>Flower</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Trending Chart -->
      <section aria-labelledby="trending-title" class="chart-box">
        <h3 id="trending-title"><i class="fas fa-chart-line"></i> Trending Herbs</h3>
        <canvas id="trendingChart" loading="lazy"></canvas>
      </section>
    </main>
  </div>

  <script>
    (function(){
      // Sidebar Toggle
      const sidebar = document.getElementById('sidebar'),
            sbToggle = document.querySelector('.toggle-sidebar'),
            mobileToggle = document.getElementById('toggleSidebarBtn');
      [sbToggle,mobileToggle].forEach(btn=>btn.addEventListener('click',()=>sidebar.classList.toggle('collapsed')));

      // Theme Persistence
      const themeBtn = document.getElementById('themeToggle'),
            saved = localStorage.getItem('theme')||'dark';
      document.documentElement.classList.toggle('light', saved==='light');
      themeBtn.classList.toggle('fa-sun', saved==='light');
      themeBtn.addEventListener('click',()=>{
        const light = document.documentElement.classList.toggle('light');
        themeBtn.classList.toggle('fa-sun', light);
        localStorage.setItem('theme', light?'light':'dark');
      });

      // Utility: update stat
      function incStat(id){ const el=document.getElementById('stat-'+id),v=+el.textContent+1;el.textContent=v; }

      // 1. Diagnostics
      document.getElementById('diagnosticsForm').addEventListener('submit',async e=>{
        e.preventDefault();
        const resEl=document.getElementById('dxResult'),btn=e.target.querySelector('button');
        btn.disabled=true;
        try {
          const data={symptoms:e.target.dxInput.value},
                res=await fetch('/api/diagnose',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
          if(!res.ok)throw '';
          const json=await res.json();
          resEl.textContent=json.suggestion;
          incStat('dx');
        } catch{ resEl.textContent='Oops—please try again later.';}
        btn.disabled=false;
      });

      // 2. Formulations
      document.getElementById('formulationForm').addEventListener('submit',async e=>{
        e.preventDefault();
        const resEl=document.getElementById('pfResult'),btn=e.target.querySelector('button'),
              herbs=[...e.target.pfHerbs.selectedOptions].map(o=>o.value),
              age=e.target.pfAge.value,wt=e.target.pfWeight.value;
        btn.disabled=true;
        try {
          const res=await fetch('/api/formulate',{method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({herbs,age,weight:wt})});
          if(!res.ok)throw '';
          const {formula}=await res.json();
          resEl.textContent=formula; incStat('form');
        } catch{ resEl.textContent='Error—try again later.';}
        btn.disabled=false;
      });

      // 3. Identification
      document.getElementById('identificationForm').addEventListener('submit',async e=>{
        e.preventDefault();
        const resEl=document.getElementById('ingResult'),btn=e.target.querySelector('button'),file=e.target.ingUpload.files[0];
        if(!file)return;
        btn.disabled=true;
        try {
          const data=new FormData();data.append('file',file);
          const res=await fetch('/api/identify',{method:'POST',body:data});
          if(!res.ok)throw '';
          const j=await res.json();
          resEl.textContent=`✅ ${j.herb} (conf ${j.confidence})`; incStat('id');
        } catch{ resEl.textContent='Error identifying ingredient.';}
        btn.disabled=false;
      });

      // 4. Efficacy
      document.getElementById('efficacyForm').addEventListener('submit',async e=>{
        e.preventDefault();
        const resEl=document.getElementById('predResult'),btn=e.target.querySelector('button'),
              q=e.target.predInput.value;
        btn.disabled=true;
        try {
          const res=await fetch('/api/efficacy',{method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({query:q})});
          if(!res.ok)throw '';
          const {score}=await res.json();
          resEl.textContent=`Predicted efficacy: ${score}%`; incStat('pred');
        } catch{ resEl.textContent='Error predicting efficacy.';}
        btn.disabled=false;
      });

      // 5. Chatbot
      document.getElementById('chatForm').addEventListener('submit',async e=>{
        e.preventDefault();
        const box=document.getElementById('chatBox'),q=e.target.chatInput.value.trim(),btn=e.target.querySelector('button');
        if(!q)return;
        box.innerHTML+=`<p><strong>You:</strong> ${q}</p>`; e.target.chatInput.value='';
        btn.disabled=true;
        try {
          const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({question:q})});
          if(!res.ok)throw '';
          const {answer}=await res.json();
          box.innerHTML+=`<p><strong>Vitra AI:</strong> ${answer}</p>`;
        } catch{ box.innerHTML+=`<p><strong>Vitra AI:</strong> Error—please try again.</p>`;}
        box.scrollTop=box.scrollHeight; btn.disabled=false;
      });

      // Search
      const search=document.getElementById('searchHerb'),rows=document.querySelectorAll('#herbTable tr');
      let to;
      search.addEventListener('input',()=>{
        clearTimeout(to);
        to=setTimeout(()=>{
          const q=search.value.toLowerCase();
          rows.forEach(r=>r.style.display=r.textContent.toLowerCase().includes(q)?'':'none');
        },300);
      });

      // Trending Chart
      new Chart(document.getElementById('trendingChart'),{
        type:'bar',data:{
          labels:['Turmeric','Ginkgo','Echinacea','Valerian','Ashwagandha'],
          datasets:[{data:[120,95,85,70,65],backgroundColor:'var(--accent)'}]
        },options:{plugins:{legend:{display:false}}}
      });
    })();
  </script>
</body>
</html>
